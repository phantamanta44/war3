package io.github.phantamanta44.war3.handler;

import io.github.phantamanta44.war3.config.Config;
import io.github.phantamanta44.war3.render.PumpedItemRenderer;
import net.minecraft.client.Minecraft;
import net.minecraft.init.Items;
import net.minecraft.item.Item;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.TickEvent;

public class KickbackHandler {

	private static double activeOffset = 0, passiveOffset = 0;
	private Minecraft mc;
	
	public KickbackHandler(Minecraft minecraft) {
		mc = minecraft;
	}
	
	@SubscribeEvent
	public void onPlayerTick(TickEvent.PlayerTickEvent event) {
		if (activeOffset > 0) {
			mc.thePlayer.rotationPitch -= activeOffset / 2;
			passiveOffset += activeOffset / 2;
			activeOffset /= 2;
		}
		if (passiveOffset > 0) {
			mc.thePlayer.rotationPitch += passiveOffset * 0.05;
			passiveOffset *= 0.95;
		}
	}
	
	public static void kickBack(double amt) {
		activeOffset = Math.min(Math.max(activeOffset, passiveOffset) + amt, 90);
	}
	
	public static void tryKickback(String path, Minecraft mc) {
		if (!Config.doKickback)
			return;
		Item i;
		try {
			i = mc.thePlayer.inventory.getCurrentItem().getItem();
		}
		catch (NullPointerException ex) {
			return;
		}
		if (mc.thePlayer.inventory.getCurrentItem().getDisplayName().contains("Reload")
				|| mc.thePlayer.inventory.getCurrentItem().getDisplayName().contains("0 | 0"))
			return;
		if (path.contains("tile.piston")) {
			if (i.getUnlocalizedName().contains("pickaxe") || i == Items.stick || i == Items.brick) {
				if (path.equals("tile.piston.out"))
					PumpedItemRenderer.setPumping(true);
				else
					PumpedItemRenderer.setPumping(false);
			}
		}
		System.out.println(Config.doKickback + "|" + mc.gameSettings.keyBindUseItem.isKeyDown());
		if (path.equals("mob.zombie.metal") && mc.gameSettings.keyBindUseItem.isPressed()) {
			if (i.getUnlocalizedName().contains("shovel") || i == Items.leather)
				kickBack(18.5D);
		}
		if (path.equals("mob.skeleton.hurt") && mc.gameSettings.keyBindUseItem.isPressed()) {
			if (i.getUnlocalizedName().contains("hoe") || i == Items.iron_ingot || i == Items.gold_ingot)
				kickBack(2.0D);
		}
		if (path.equals("note.snare")) {
			if (i.getUnlocalizedName().contains("hoe"))
				kickBack(4.6D);
		}
		if (path.equals("mob.ghast.fireball")) {
			if (i.getUnlocalizedName().contains("pickaxe") || i == Items.stick || i == Items.brick)
				kickBack(30.0D);
		}
		if ((path.equals("game.tnt.primed") || path.equals("creeper.primed")) && mc.gameSettings.keyBindUseItem.isPressed()) {
			if (i.getUnlocalizedName().equals("hoe_gold"))
				kickBack(24.0D);
		}
		if (path.equals("mob.irongolem.hit") && mc.gameSettings.keyBindUseItem.isPressed()) {
			if ((i.getUnlocalizedName().contains("axe") && !i.getUnlocalizedName().contains("pickaxe")) || i == Items.bowl || i == Items.paper)
				kickBack(24.9D);
		}
	}
	
}
